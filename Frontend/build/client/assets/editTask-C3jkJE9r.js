import{w as P}from"./with-props-DSW1myl8.js";import{r as o,j as e,c as B,g as O}from"./chunk-DQRVZFIR-CtLrds9g.js";/* empty css                 */import{c as J}from"./createLucideIcon-DpBpHvh4.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],z=J("plus",U),q=()=>{const[r,h]=o.useState(!1);return e.jsx("button",{type:"button",className:"calendar-button",onClick:()=>{},disabled:r,children:"ðŸ“… Link to Google Calendar"})},M=({application:r,onSuccess:h})=>{const[m,f]=o.useState(!1),[j,n]=o.useState(""),[x,p]=o.useState(""),[d,k]=o.useState(""),[L,y]=o.useState(!1),[b,l]=o.useState(""),[g,E]=o.useState([]),[A,T]=o.useState(!1),[S,C]=o.useState({});o.useEffect(()=>{r!=null&&r.id&&v()},[r==null?void 0:r.id]),o.useEffect(()=>{const t=setInterval(()=>{const s={};g.forEach(u=>{const _=new Date().getTime(),a=new Date(u.due_date).getTime()-_;if(a>0){const i=Math.floor(a/864e5),c=Math.floor(a%(1e3*60*60*24)/(1e3*60*60)),$=Math.floor(a%(1e3*60*60)/(1e3*60));let D="";i>0?D=`${i}d ${c}h ${$}m`:c>0?D=`${c}h ${$}m`:D=`${$}m left`,s[u.id]={timeLeft:D,isOverdue:!1}}else s[u.id]={timeLeft:"Overdue",isOverdue:!0}}),C(s)},1e3);return()=>clearInterval(t)},[g]);const w=t=>{try{const s=new Date(t);return isNaN(s.getTime())?"Invalid Date":s.toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return"Invalid Date"}},N=async t=>{t.preventDefault(),l(""),y(!0);try{const s=await fetch("http://localhost:5000/api/auth/task",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({title:j,description:x,due_date:d,job_application_id:r.id})}),u=await s.json();s.ok?(h&&h(),f(!1),n(""),p(""),k(""),v()):l(u.message||"Failed to add task")}catch(s){console.error("Network error:",s),l("Network error. Please check if your backend is running.")}finally{y(!1)}},v=async()=>{try{const t=await fetch(`http://localhost:5000/api/auth/FetchTask/${r.id}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await t.json();t.ok?E(Array.isArray(s)?s:[]):l(s.message||"Failed to fetch tasks")}catch(t){console.error("Error fetching tasks:",t),l("Failed to load tasks")}finally{T(!1)}},F=async t=>{try{const s=await fetch(`http://localhost:5000/api/auth/DeleteTask/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok)console.log("Deleted Task successfully."),v();else{const u=await s.json();l(u.message||"Failed to delete task")}}catch(s){console.error("Error deleting task:",s),l("Failed to delete task")}};return e.jsxs("div",{className:"upcoming-tasks-container",children:[e.jsxs("div",{className:"tasks-header",children:[e.jsx("h2",{children:"Upcoming Tasks"}),e.jsxs("button",{className:"add-task-btn",onClick:()=>f(!m),children:[e.jsx(z,{size:16}),"Add Task"]})]}),m&&e.jsx("form",{onSubmit:N,children:e.jsxs("div",{className:"add-task-form",children:[e.jsx("input",{type:"text",placeholder:"Task title",value:j,onChange:t=>n(t.target.value)}),e.jsx("textarea",{placeholder:"Description (optional)",value:x,onChange:t=>p(t.target.value)}),e.jsxs("div",{className:"form-row",children:[e.jsx("p",{children:"Due Date:"}),e.jsx("input",{placeholder:"Task Due Date",type:"datetime-local",value:d,onChange:t=>k(t.target.value)})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"save-btn",children:"Save Task"}),e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>f(!1),children:"Cancel"})]})]})}),A?e.jsx("div",{children:"Loading tasks..."}):b?e.jsx("div",{className:"error-message",children:b}):g.length===0?e.jsx("div",{className:"empty-tasks",children:"No tasks found for this application"}):g.map(t=>{const s=S[t.id]||{timeLeft:"Calculating...",isOverdue:!1};return e.jsx("div",{className:"taskDisplay",children:e.jsxs("div",{className:`taskCard ${t.is_completed?"completed":""}`,children:[e.jsxs("div",{className:"task-header",children:[e.jsx("div",{className:"task-title",children:e.jsx("h3",{children:t.title})}),e.jsx("button",{className:"task-delete-btn",onClick:()=>F(t.id),"aria-label":"Delete task",children:"Ã—"})]}),t.description&&e.jsx("div",{className:"task-description",children:e.jsx("p",{children:t.description})}),e.jsx("div",{className:"calendarButton",children:e.jsx(q,{})}),e.jsxs("div",{className:"task-due-date",children:[e.jsx("strong",{children:"Due: "}),w(t.due_date)]}),e.jsx("div",{className:`task-countdown ${s.isOverdue?"overdue":""}`,children:s.timeLeft})]},t.id)})})]})},G=({application:r,onSuccess:h})=>{const{id:m}=B(),[f,j]=o.useState(!0),[n,x]=o.useState(!1),[p,d]=o.useState(""),[k,L]=o.useState(""),[y,b]=o.useState(""),[l,g]=o.useState(""),[E,A]=o.useState(""),[T,S]=o.useState(""),[C,w]=o.useState(""),[N,v]=o.useState(""),[F,t]=o.useState(null),s=O();o.useEffect(()=>{(async()=>{if(!m){d("No application ID provided"),j(!1);return}try{j(!0);const i=await fetch(`http://localhost:5000/api/auth/SingleApplication/${m}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),c=await i.json();i.ok?(t(c),u(c)):d(c.message||"Failed to fetch application")}catch(i){console.error("Failed to fetch application:",i),d("Failed to load application data")}finally{j(!1)}})()},[m]);const u=a=>{L(a.job_title),b(a.company_name),g(a.salary_range||""),S(a.job_url||""),w(a.notes||""),v(a.status)},_=async a=>{a.preventDefault(),d(""),x(!0);try{const i=await fetch(`http://localhost:5000/api/auth/EditApplication/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({job_title:k,company_name:y,salary_range:l,status:N,job_url:T,notes:C,previous_status:N})}),c=await i.json();i.ok?(console.log("Application updated successfully:",c),h&&h(),s("/progressLine")):d(c.message||"Failed to update application")}catch(i){console.error("Network error:",i),d("Network error. Please check if your backend is running.")}finally{x(!1)}};if(f)return e.jsx("div",{className:"background",children:e.jsx("div",{style:{paddingTop:"2rem"},children:e.jsx("div",{className:"container",children:e.jsx("div",{children:"Loading application data..."})})})});if(p&&!r)return e.jsx("div",{className:"background",children:e.jsx("div",{style:{paddingTop:"2rem"},children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{color:"red"},children:["Error: ",p]}),e.jsx("button",{onClick:()=>s("/progressLine"),children:"Back to Job Progress Line"})]})})});const I=()=>{s("/progressLine")};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"background",children:e.jsx("div",{style:{paddingTop:"2rem"},children:e.jsxs("div",{className:"GridContainer",children:[e.jsx("div",{className:"UpcomingTasks",children:e.jsx(M,{application:F,onSuccess:h})}),e.jsx("div",{className:"TaskContainer",children:e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"form",children:[e.jsx("h2",{children:" Edit Task"}),p&&e.jsx("div",{className:"error-message",style:{color:"red",marginBottom:"1rem"},children:p}),e.jsx("input",{type:"text",name:"jobTitle",value:k,onChange:a=>L(a.target.value),placeholder:"Enter job title",required:!0,disabled:n}),e.jsx("input",{type:"text",name:"company",value:y,onChange:a=>b(a.target.value),placeholder:"Company Name",required:!0,disabled:n}),e.jsx("input",{type:"number",name:"salary",value:l,onChange:a=>g(a.target.value),placeholder:"Enter salary",required:!0,disabled:n,min:"0",step:"1000"}),e.jsxs("select",{name:"workType",value:E,onChange:a=>A(a.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select work type"}),e.jsx("option",{value:"full-time",children:"Full Time"}),e.jsx("option",{value:"part-time",children:"Part Time"}),e.jsx("option",{value:"casual",children:"Casual"})]}),e.jsx("input",{type:"url",name:"jobLink",value:T,onChange:a=>S(a.target.value),placeholder:"Job Link",required:!0,disabled:n}),e.jsx("textarea",{className:"additional-notes",name:"notes",value:C,onChange:a=>w(a.target.value),placeholder:"Additional Notes",disabled:n}),e.jsxs("select",{name:"progressionStatus",value:N,onChange:a=>v(a.target.value),required:!0,disabled:n,children:[e.jsx("option",{value:"",children:"Select progression status"}),e.jsx("option",{value:"Applied",children:"Applied"}),e.jsx("option",{value:"CognitiveTesting",children:"Cognitive Test"}),e.jsx("option",{value:"DigitalInterview",children:"Digital Interview"}),e.jsx("option",{value:"CodeExam",children:"Code Exam"}),e.jsx("option",{value:"Interview",children:"In-Person Interview"})]})]}),e.jsxs("div",{className:"submitButtons",children:[e.jsx("button",{type:"submit",disabled:n,children:n?"Updating Application...":"Update Application"}),e.jsx("button",{type:"button",onClick:I,disabled:n,children:"Back to Job Progress Line"})]})]})})]})})})})},Q=P(G);export{Q as default};
